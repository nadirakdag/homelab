services:
  traefik:
    image: traefik:v3.6.4
    container_name: traefik
    restart: unless-stopped
    command:
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--ping=true"
      - "--api.dashboard=true"
      - "--api.insecure=true"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      - "traefik.http.routers.traefik.service=api@internal"
    networks:
      - proxy
    healthcheck:
      test: ["CMD", "traefik", "healthcheck", "--ping"]
      interval: 30s
      timeout: 3s


  pulse:
    image: rcourtman/pulse:latest
    container_name: pulse
    restart: unless-stopped
    volumes:
      - ./data/pulse:/data
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pulse.rule=Host(`pulse.nlab.sh`)"
      - "traefik.http.services.pulse.loadbalancer.server.port=7655"

  myspeed:
    image: germannewsmaker/myspeed
    container_name: myspeed
    restart: unless-stopped
    volumes:
      - ./data/myspeed:/myspeed/data
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.myspeed.rule=Host(`myspeed.nlab.sh`)"
      - "traefik.http.services.myspeed.loadbalancer.server.port=5216"

  gatus:
    image: twinproduction/gatus:stable
    container_name: gatus
    restart: unless-stopped
    networks:
      - proxy
    volumes:
      - ./data/gatus:/config
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.gatus.rule=Host(`gatus.nlab.sh`)"
      - "traefik.http.services.gatus.loadbalancer.server.port=8080"

  it-tools:
    image: sharevb/it-tools:latest
    container_name: it-tools
    restart: unless-stopped
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ittools.rule=Host(`tools.nlab.sh`)"
      - "traefik.http.services.ittools.loadbalancer.server.port=8080"

  whoami:
    image: "traefik/whoami"
    container_name: whoami
    restart: unless-stopped
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.whoami.rule=Host(`whoami.nlab.sh`)"
      - "traefik.http.routers.whoami.entrypoints=web"

  nexterm:
    image: germannewsmaker/nexterm:latest
    container_name: nexterm
    restart: always
    environment:
      ENCRYPTION_KEY: ${NEXTERM_ENCRYPTION_KEY}
    networks:
      - proxy
    volumes:
      - ./data/nexterm:/app/data
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nexterm.rule=Host(`nexterm.nlab.sh`)"
      - "traefik.http.services.nexterm.loadbalancer.server.port=6989"


  whois:
      image: dumbwareio/dumbwhois:latest
      container_name: whois
      restart: unless-stopped
      networks:
        - proxy
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.whois.rule=Host(`whois.nlab.sh`)"
        - "traefik.http.services.whois.loadbalancer.server.port=3000"
  
  notepad:
    image: dumbwareio/dumbpad:latest
    container_name: notepad
    restart: unless-stopped
    volumes:
      - ./data/notepad:/app/data
    networks:
      - proxy
    environment:
      DUMBBUDGET_PIN: ${DUMB_PIN}
      BASE_URL: 'notepad.nlab.sh'
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.notepad.rule=Host(`notepad.nlab.sh`)"
      - "traefik.http.services.notepad.loadbalancer.server.port=3000"

networks:
  proxy:
    name: proxy  
